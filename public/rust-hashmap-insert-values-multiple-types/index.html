<!doctypehtml><html lang=en><meta charset=utf-8><title>Inserting values of multiple types in Rust's HashMap - Simone Web Design</title><meta content="Simone Vittori"name=author><meta content="How to build a heterogeneous collection in Rust, using values of different types."name=description><meta content="width=device-width,initial-scale=1"name=viewport><link href=https://www.simonewebdesign.it/rust-hashmap-insert-values-multiple-types/ rel=canonical><link href='data:application/manifest+json,{"name":"Simone Web Design","short_name":"SimoneDesign","theme_color":"%23555","background_color":"%23f6f6f6","display":"minimal-ui","description":"A tech blog"}'rel=manifest><link href="data:image/svg+xml,%3csvg version='1.0' xmlns='http://www.w3.org/2000/svg' width='1288' height='1706.667' viewBox='0 0 966 1280'%3e%3cpath d='M415 47.7c-48.3 2.9-95.2 13.8-134.6 31.3-49.9 22.1-94.6 57.7-127.4 101.5C118.4 226.6 98.5 280 91.8 344c-1.6 16-1.6 62.1 0 76.5 6.5 56.5 23.1 102.8 52.5 146.8 38.8 58.1 96.4 104.6 169.8 137C338.2 715 346 717.7 497 768.5c69.7 23.4 85.3 29.2 113.3 42.2 32.5 15 54.9 29.4 72.3 46.8 20.8 20.6 31.4 40 37.6 68.8 3 13.8 3.3 48.3.5 62.1-5.6 27.4-17.3 50.3-36.2 70.3-37.2 39.6-88.3 59.3-153.5 59.3-72.7 0-136.2-25.5-198-79.6-51.9-45.3-101.8-115.9-141-199.3-9.8-20.9-23.9-53.7-30.5-71.4l-4.8-12.7H58.3l-2.2 2.3-2.2 2.4 7.6 145.9c14.4 279.1 15.5 299.9 16 301.1.3 1 9.9 1.3 43.4 1.3 23.6 0 43.2-.4 43.5-.8.2-.4 1-4.6 1.6-9.2 3.2-24.6 13.9-48.4 25.7-57.8 8.7-6.8 11.7-7.7 24.8-7.6 18.1.1 30.1 3.8 84 25.9 63.1 25.8 128.5 44.6 179.8 51.6 19.4 2.6 68.4 3.7 90.4 2 92.5-7.3 167.4-39.7 228.7-99.1 61.9-60 95.3-133.7 102.7-227.1 1.5-18.5.6-64.8-1.6-83.4-9.4-81-39-145.8-91-199.4-42.1-43.4-97.4-78.2-167.7-105.7-21.2-8.3-30.8-11.5-126.8-41.9-99-31.4-105.3-33.5-122.4-40.7-35.2-14.7-61.8-31.9-84.1-54.3-22-22-34.5-44.7-38.5-69.7-2-12.1-.8-34.9 2.4-47.1 5-19.5 15.5-37.3 30.4-52.2 26.2-25.9 59.2-41.3 103.7-48.1 9.6-1.5 17.6-1.9 40.5-1.9 25.3 0 29.9.3 41.3 2.3 77.4 13.9 141 59.2 200 142.5 20.3 28.5 35.9 55 56.8 96.2l15.7 31 38.9.3 38.9.2 2.8-2.9 2.8-2.9-7.7-146.4c-4.2-80.4-8.4-160.7-9.3-178.3l-1.7-32-38 .3c-20.9.2-38.3.7-38.6 1-.3.4-1.4 3.8-2.4 7.7-4.4 17.3-13.3 33.7-22.2 41.4-10.6 9-20.8 11.5-36 8.7-5.4-1-11.8-2.2-14.3-2.6-2.5-.5-12.8-4.6-23-9.3C590.2 70.9 524.9 52.6 470.5 48c-11.1-.9-42.6-1.1-55.5-.3z' fill='%23333'/%3e%3c/svg%3e"rel=icon><style>html{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;background:#f6f6f6;font-family:"PT Serif",Georgia,Times,"Times New Roman",serif;color:#333;border-top:3px solid #555}body{margin:0 1em}.projects li,time{font-family:"PT Sans","Helvetica Neue",Arial,sans-serif;font-size:85%;color:#aaa}main{max-width:65ch;margin:0 auto}h1,h2,h3,h4,h5,h6{margin-top:1.6em}header{text-align:center}header a{color:inherit;text-decoration:none}header+p{text-align:center}p{line-height:1.65}nav ul{padding-left:0}li+li{margin-top:.5rem}blockquote{font-style:italic;font-size:1.2em;line-height:1.5em;padding-left:1em;border-left:4px solid rgba(170,170,170,.5)}hr{border:0;border-top:1px dotted rgba(170,170,170,.5);margin:1.5rem}abbr[title]{text-decoration:none;border-bottom:1px dotted #aaa}@media (min-width:48rem){html{font-size:115%}article header{position:relative}.entry-title{width:95vw;position:relative;left:calc(50% - 95vw / 2)}}@media (min-width:60rem){.entry-title{width:54rem;left:calc(50% - 54rem / 2)}}@media (min-width:115rem){html{font-size:130%}}a{color:#1863a1}a:visited{color:#751590}a:focus{color:#0181eb}a:hover{color:#0181eb}a:active{color:#01579f}article{outline:0}.basic-alignment{margin-top:.5rem}.basic-alignment.left{float:left;margin-right:.5rem}.basic-alignment.right{float:right;margin-left:.5rem}.link-btn{padding:.8rem 1rem;margin:3rem 0}[role=banner]{color:#555;font-weight:400;text-align:center}[role=banner] a,[role=banner] a:hover,[role=banner] a:visited{color:inherit}header+nav{text-align:center;border-bottom:1px solid rgba(170,170,170,.5);padding:.85rem 0}header+nav ul{list-style:none;margin:0;padding-left:0}header+nav li{display:inline-block}header+nav li+li{margin-top:0;margin-left:1rem}header+nav a{color:#666;text-decoration:none}@media (min-width:960px){header+nav{width:870px;margin:0 auto}}.blog-index .entry-title a,.blog-index .entry-title a:hover,.blog-index .entry-title a:visited{color:#555}.blog-index .intro{font-size:1rem;border:0;margin-left:0;margin-right:0;padding:.9rem;text-align:justify}.blog-index article+article{margin-top:6rem}article header h1{font-size:2.2rem;color:#555;margin-bottom:.32em}article header time{color:#aaa}article .meta{margin-top:0}article a{text-decoration:none}article a:hover{text-decoration:underline}h2 code{font-size:1.4em}.author{display:block}.entry-content{margin:2rem 8px 3rem 8px}#disqus_thread{min-height:1px;max-width:870px;margin:0 auto}.article-cta{text-align:center;margin:3rem 0 3.5rem 0;padding:3rem 0 3.5rem 0;border-width:0;border-top-width:1px;border-bottom-width:1px;border-style:dotted;border-color:rgba(170,170,170,.5);font-size:.95em;line-height:150%}.article-cta>h2{margin-bottom:0}.article-cta>form{margin-bottom:.5rem}[name=subscribe]{margin-top:2rem}[name=subscribe] button,[name=subscribe] input{font-size:1rem;padding:.6rem .5rem}[name=subscribe] input{box-sizing:border-box;width:50%;font-size:1rem;border:2px solid #dbdfe4;border-radius:.25em;outline:0;background-clip:padding-box}[name=subscribe] input:focus{border-color:#268bd2}[name=subscribe] ::placeholder{color:#687a86}[name=subscribe] button{border-radius:.25em;color:#fff;padding-left:1rem;padding-right:1rem;box-shadow:none;background:rgba(88,88,88,.2);border:2px solid transparent;transition:all .2s;cursor:pointer}[name=subscribe] button:active{box-shadow:inset 0 3px 6px #1a6091}[name=subscribe] button:focus,[name=subscribe] input:focus+button{background:#268bd2;border:2px solid #268bd2}@media (min-width:500px){[name=subscribe] input{width:28%;margin-right:2%}}.highlight{margin-left:auto;margin-right:auto;border-radius:3px;font-size:.9rem}.highlight code{box-shadow:inset 0 0 5px 0 rgba(0,0,0,.25)}.highlight .c{color:#998;font-style:italic}.highlight .err{color:#a61717;background-color:#e3d2d2}.highlight .k{font-weight:700}.highlight .o{font-weight:700}.highlight .cm{color:#998;font-style:italic}.highlight .cp{color:#999;font-weight:700}.highlight .c1{color:#998;font-style:italic}.highlight .cs{color:#999;font-weight:700;font-style:italic}.highlight .gd{color:#000;background-color:#fdd}.highlight .gd .x{color:#000;background-color:#faa}.highlight .ge{font-style:italic}.highlight .gr{color:#a00}.highlight .gh{color:#999}.highlight .gi{color:#000;background-color:#dfd}.highlight .gi .x{color:#000;background-color:#afa}.highlight .go{color:#888}.highlight .gp{color:#555}.highlight .gs{font-weight:700}.highlight .gu{color:#aaa}.highlight .gt{color:#a00}.highlight .kc{font-weight:700}.highlight .kd{font-weight:700}.highlight .kp{font-weight:700}.highlight .kr{font-weight:700}.highlight .kt{color:#458;font-weight:700}.highlight .m{color:#099}.highlight .s{color:#d14}.highlight .na{color:teal}.highlight .nb{color:#0086b3}.highlight .nc{color:#458;font-weight:700}.highlight .no{color:teal}.highlight .ni{color:purple}.highlight .ne{color:#900;font-weight:700}.highlight .nf{color:#900;font-weight:700}.highlight .nn{color:#555}.highlight .nt{color:navy}.highlight .nv{color:teal}.highlight .ow{font-weight:700}.highlight .w{color:#bbb}.highlight .mf{color:#099}.highlight .mh{color:#099}.highlight .mi{color:#099}.highlight .mo{color:#099}.highlight .sb{color:#d14}.highlight .sc{color:#d14}.highlight .sd{color:#d14}.highlight .s2{color:#d14}.highlight .se{color:#d14}.highlight .sh{color:#d14}.highlight .si{color:#d14}.highlight .sx{color:#d14}.highlight .sr{color:#009926}.highlight .s1{color:#d14}.highlight .ss{color:#990073}.highlight .bp{color:#999}.highlight .vc{color:teal}.highlight .vg{color:teal}.highlight .vi{color:teal}.highlight .il{color:#099}.applescript{white-space:pre-wrap}.highlight table td.code{width:100%}.highlight .line-numbers{display:none;text-align:right;line-height:1.45em;background:#fefefe!important;border-right:1px solid #e0e0e0!important;-moz-box-shadow:#fff -1px 0 inset;-webkit-box-shadow:#fff -1px 0 inset;box-shadow:#fff -1px 0 inset;text-shadow:#eaeaea 0 -1px;padding:.8em!important;border-radius:0}.highlight .line-numbers span{color:#93a1a1!important}pre{background:#fbfbfb;border-radius:.4em;font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;border:1px solid #d8d8d8;line-height:1.45em;padding:.8em 1em;color:#586e75;overflow:auto}h3.filename+pre{-moz-border-radius-topleft:0;-webkit-border-top-left-radius:0;border-top-left-radius:0;-moz-border-radius-topright:0;-webkit-border-top-right-radius:0;border-top-right-radius:0}li code,p code{font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;display:inline-block;background:#fff;font-size:.8em;line-height:1.5em;color:#555;border:1px solid #ddd;border-radius:.4em;padding:0 .3em;margin:-1px 0}li pre code,p pre code{font-size:1em!important;background:0 0;border:none}.highlight code,.pre-code{font-family:Menlo,Monaco,"Andale Mono","lucida console","Courier New",monospace;overflow:scroll;overflow-y:hidden;display:block;padding:.8em;overflow-x:auto;line-height:1.45em;background:#fbfbfb!important;color:#586e75!important}.highlight code span,.pre-code span{color:#586e75!important}.highlight code span,.pre-code span{font-style:normal!important;font-weight:400!important}.highlight code .c,.pre-code .c{color:#93a1a1!important;font-style:italic!important}.highlight code .cm,.pre-code .cm{color:#93a1a1!important;font-style:italic!important}.highlight code .cp,.pre-code .cp{color:#93a1a1!important;font-style:italic!important}.highlight code .c1,.pre-code .c1{color:#93a1a1!important;font-style:italic!important}.highlight code .cs,.pre-code .cs{color:#93a1a1!important;font-weight:700!important;font-style:italic!important}.highlight code .err,.pre-code .err{color:#dc322f!important;background:0 0!important}.highlight code .k,.pre-code .k{color:#cb4b16!important}.highlight code .o,.pre-code .o{color:#586e75!important;font-weight:700!important}.highlight code .p,.pre-code .p{color:#586e75!important}.highlight code .ow,.pre-code .ow{color:#2aa198!important;font-weight:700!important}.highlight code .gd,.pre-code .gd{color:#586e75!important;background-color:#f3c9c8!important;display:inline-block}.highlight code .gd .x,.pre-code .gd .x{color:#586e75!important;background-color:#f0b5b4!important;display:inline-block}.highlight code .ge,.pre-code .ge{color:#586e75!important;font-style:italic!important}.highlight code .gh,.pre-code .gh{color:#93a1a1!important}.highlight code .gi,.pre-code .gi{color:#586e75!important;background-color:#e3e7c9!important;display:inline-block}.highlight code .gi .x,.pre-code .gi .x{color:#586e75!important;background-color:#ccd497!important;display:inline-block}.highlight code .gs,.pre-code .gs{color:#586e75!important;font-weight:700!important}.highlight code .gu,.pre-code .gu{color:#6c71c4!important}.highlight code .kc,.pre-code .kc{color:#859900!important;font-weight:700!important}.highlight code .kd,.pre-code .kd{color:#268bd2!important}.highlight code .kp,.pre-code .kp{color:#cb4b16!important;font-weight:700!important}.highlight code .kr,.pre-code .kr{color:#d33682!important;font-weight:700!important}.highlight code .kt,.pre-code .kt{color:#2aa198!important}.highlight code .n,.pre-code .n{color:#268bd2!important}.highlight code .na,.pre-code .na{color:#268bd2!important}.highlight code .nb,.pre-code .nb{color:#859900!important}.highlight code .nc,.pre-code .nc{color:#d33682!important}.highlight code .no,.pre-code .no{color:#b58900!important}.highlight code .nl,.pre-code .nl{color:#859900!important}.highlight code .ne,.pre-code .ne{color:#268bd2!important;font-weight:700!important}.highlight code .nf,.pre-code .nf{color:#268bd2!important;font-weight:700!important}.highlight code .nn,.pre-code .nn{color:#b58900!important}.highlight code .nt,.pre-code .nt{color:#268bd2!important;font-weight:700!important}.highlight code .nx,.pre-code .nx{color:#b58900!important}.highlight code .vg,.pre-code .vg{color:#268bd2!important}.highlight code .vi,.pre-code .vi{color:#268bd2!important}.highlight code .nv,.pre-code .nv{color:#268bd2!important}.highlight code .mf,.pre-code .mf{color:#2aa198!important}.highlight code .m,.pre-code .m{color:#2aa198!important}.highlight code .mh,.pre-code .mh{color:#2aa198!important}.highlight code .mi,.pre-code .mi{color:#2aa198!important}.highlight code .s,.pre-code .s{color:#2aa198!important}.highlight code .sd,.pre-code .sd{color:#2aa198!important}.highlight code .s2,.pre-code .s2{color:#2aa198!important}.highlight code .se,.pre-code .se{color:#dc322f!important}.highlight code .si,.pre-code .si{color:#268bd2!important}.highlight code .sr,.pre-code .sr{color:#2aa198!important}.highlight code .s1,.pre-code .s1{color:#2aa198!important}.highlight code div .gd,.highlight code div .gd .x,.highlight code div .gi,.highlight code div .gi .x,.pre-code div .gd,.pre-code div .gd .x,.pre-code div .gi,.pre-code div .gi .x{display:inline-block;width:100%}.highlight{margin-bottom:1.8em;background:#fbfbfb;overflow-y:hidden;overflow-x:auto}.highlight pre{background:0 0;border-radius:0;border:none;padding:0;margin:0}.highlight code{background:#000;text-align:left}main+footer{text-align:center;margin:3rem 0}main+footer a{text-decoration:none}main+footer a:hover svg{transform:scale(1.05);opacity:1}main+footer svg{transition:transform .15s,opacity .15s;opacity:.95;height:3.5rem}.footer-social{max-width:720px;margin:3rem auto 0 auto}@media (min-width:48rem){svg{padding:0 1.5rem}}@media (prefers-color-scheme:dark){html,li code,p code,pre{background:#181a1b!important;color:#e8e6e3}.blog-archives a,.entry-title,h1{color:#c9c5be}.entry-title a{color:inherit!important}a{color:#7abbeb}a:visited{color:#d683ed}a:focus{color:#40acfe}a:hover{color:#40acfe}a:active{color:#6dc0fe}header+nav{background:rgba(24,26,27,.95)}#blog-archives article a,[role=banner] a,header+nav a{color:#c9c5be!important}div.category-index article+article h1,header+nav,li code,p code,pre{border-color:#3a3a3a}.highlight{background-color:#0e1010;border-color:#2f2f2f!important}.highlight code{background-color:#0e1010!important}[name=subscribe] input{border-color:#2f2f2f;background-color:rgba(44,44,44,.2);color:#fff}[name=subscribe] input:focus{background-color:#fff;color:#000}}</style><link href=https://feeds.feedburner.com/simonewebdesign rel=alternate title="Simone Web Design"type=application/atom+xml><header><h1 role=banner><a href=/ >Simone Web Design</a></h1></header><nav><ul><li><a href=/ >Home</a><li><a href=/archives/ >Blog</a><li><a href=/projects/ >Projects</a><li><a href=/about/ >About</a></ul></nav><main><div><article class=hentry tabindex=-1><header><h1 class=entry-title>Inserting values of multiple types in Rust's HashMap</h1><p class=meta><time>6th Jul 2020</time></header><div class=entry-content><p>I was building a generic data store with Rust and I needed to implement a <strong>heterogeneous collection</strong> of keys and values. Essentially what I needed was a dictionary, but with values of dynamic type, like both strings and integers at the same time.<p>Rust is a statically typed language and, due to the memory safety guarantees we are given, all values of some type must have a known, fixed size at compile time, therefore we are not allowed to create a collection of multiple types. However, <a href=https://doc.rust-lang.org/reference/dynamically-sized-types.html rel=external>dynamically sized types</a> also exist, and in this article I’ll show how to use them.<p>Say we have a <a href=https://doc.rust-lang.org/std/collections/struct.HashMap.html rel=external><code class="highlighter-rouge language-plaintext">HashMap</code></a> and we want to add more than one value type to it.<p>For example:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nn>std</span><span class=p>::</span><span class=nn>collections</span><span class=p>::</span><span class=n>HashMap</span><span class=p>;</span>

<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>let</span> <span class=k>mut</span> <span class=n>map</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>

    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"a"</span><span class=p>,</span> <span class=s>"1"</span><span class=p>);</span>
    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=s>"2"</span><span class=p>);</span>

    <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=n>in</span> <span class=o>&amp;</span><span class=n>map</span> <span class=p>{</span>
        <span class=nd>println!</span><span class=p>(</span><span class=s>"{}: {}"</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>This prints:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=n>a</span><span class=p>:</span> <span class=mi>1</span>
<span class=n>b</span><span class=p>:</span> <span class=mi>2</span>
</code></pre></div></div><p>In the example above, the type of <code class="highlighter-rouge language-plaintext">map</code> is <code class="highlighter-rouge language-plaintext">HashMap&lt;&amp;str, &amp;str&gt;</code>. In other words, both keys and values are of type <code class="highlighter-rouge language-plaintext">&amp;str</code>. What if we want the values to be of type <code class="highlighter-rouge language-plaintext">&amp;str</code> <em>and</em>, say, <code class="highlighter-rouge language-plaintext">i32</code>?<p>This won’t work:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nn>std</span><span class=p>::</span><span class=nn>collections</span><span class=p>::</span><span class=n>HashMap</span><span class=p>;</span>

<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>let</span> <span class=k>mut</span> <span class=n>map</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>

    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"a"</span><span class=p>,</span> <span class=s>"1"</span><span class=p>);</span>
    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>

    <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=n>in</span> <span class=o>&amp;</span><span class=n>map</span> <span class=p>{</span>
        <span class=nd>println!</span><span class=p>(</span><span class=s>"{}: {}"</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>If we try it, we get this compile time error:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=n>error</span><span class=p>[</span><span class=n>E0308</span><span class=p>]:</span> <span class=n>mismatched</span> <span class=n>types</span>
  <span class=o>-</span><span class=k>-&gt;</span> <span class=n>src</span><span class=o>/</span><span class=n>main</span><span class=py>.rs</span>

     <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
                     <span class=o>^</span> <span class=n>expected</span> <span class=err>`</span><span class=o>&amp;</span><span class=nb>str</span><span class=err>`</span><span class=p>,</span> <span class=n>found</span> <span class=n>integer</span>
</code></pre></div></div><p>So how do we <strong>insert multiple value types</strong> in a <code class="highlighter-rouge language-plaintext">HashMap</code>? We have several options, each of them with its own trade-offs.<h2 id=option-1-use-an-enum>Option #1: Use an <code class="highlighter-rouge language-plaintext">enum</code></h2><p>We can define our own <a href=https://doc.rust-lang.org/std/keyword.enum.html rel=external><code class="highlighter-rouge language-plaintext">enum</code></a> to model our value type, and insert that into the hashmap:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nn>std</span><span class=p>::</span><span class=nn>collections</span><span class=p>::</span><span class=n>HashMap</span><span class=p>;</span>

<span class=nd>#[derive(Debug)]</span>
<span class=k>enum</span> <span class=n>Value</span> <span class=p>{</span>
    <span class=nf>Str</span><span class=p>(</span><span class=o>&amp;</span><span class=nv>'static</span> <span class=nb>str</span><span class=p>),</span>
    <span class=nf>Int</span><span class=p>(</span><span class=nb>i32</span><span class=p>),</span>
<span class=p>}</span>

<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>let</span> <span class=k>mut</span> <span class=n>map</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>

    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"a"</span><span class=p>,</span> <span class=nn>Value</span><span class=p>::</span><span class=nf>Str</span><span class=p>(</span><span class=s>"1"</span><span class=p>));</span>
    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=nn>Value</span><span class=p>::</span><span class=nf>Int</span><span class=p>(</span><span class=mi>2</span><span class=p>));</span>

    <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=n>in</span> <span class=o>&amp;</span><span class=n>map</span> <span class=p>{</span>
        <span class=nd>println!</span><span class=p>(</span><span class=s>"{}: {:?}"</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>This prints:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=n>a</span><span class=p>:</span> <span class=nf>Str</span><span class=p>(</span><span class=s>"1"</span><span class=p>)</span>
<span class=n>b</span><span class=p>:</span> <span class=nf>Int</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</code></pre></div></div><p>This is similar to a <a href=https://doc.rust-lang.org/reference/items/unions.html rel=external>union type</a>. By inserting values of type <code class="highlighter-rouge language-plaintext">Value::*</code>, we are effectively saying that the map can accept types that are either string, integer, or any other composite type we wish to add.<h2 id=option-2-use-a-box>Option #2: Use a <code class="highlighter-rouge language-plaintext">Box</code></h2><p>We can wrap our types in the <a href=https://doc.rust-lang.org/std/boxed/struct.Box.html rel=external title=std::boxed::Box><code class="highlighter-rouge language-plaintext">Box</code></a> struct:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nn>std</span><span class=p>::</span><span class=nn>collections</span><span class=p>::</span><span class=n>HashMap</span><span class=p>;</span>

<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>let</span> <span class=k>mut</span> <span class=n>map</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>

    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"a"</span><span class=p>,</span> <span class=nn>Box</span><span class=p>::</span><span class=nf>new</span><span class=p>(</span><span class=s>"1"</span><span class=p>));</span>
    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=nn>Box</span><span class=p>::</span><span class=nf>new</span><span class=p>(</span><span class=mi>2</span><span class=p>));</span>

    <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=n>in</span> <span class=o>&amp;</span><span class=n>map</span> <span class=p>{</span>
        <span class=nd>println!</span><span class=p>(</span><span class=s>"{}: {}"</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>This doesn’t compile right away. If we try to run this, we get a “mismatched types” error:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=n>error</span><span class=p>[</span><span class=n>E0308</span><span class=p>]:</span> <span class=n>mismatched</span> <span class=n>types</span>
<span class=o>-</span><span class=k>-&gt;</span> <span class=n>src</span><span class=o>/</span><span class=n>main</span><span class=py>.rs</span>

    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=nn>Box</span><span class=p>::</span><span class=nf>new</span><span class=p>(</span><span class=mi>2</span><span class=p>));</span>
                             <span class=o>^</span> <span class=n>expected</span> <span class=err>`</span><span class=o>&amp;</span><span class=nb>str</span><span class=err>`</span><span class=p>,</span> <span class=n>found</span> <span class=n>integer</span>
</code></pre></div></div><p>Luckily we can fix this by explicitly declaring the type of our map:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=k>let</span> <span class=k>mut</span> <span class=n>map</span><span class=p>:</span> <span class=n>HashMap</span><span class=o>&lt;&amp;</span><span class=nb>str</span><span class=p>,</span> <span class=nb>Box</span><span class=o>&lt;</span><span class=n>dyn</span> <span class=n>Display</span> <span class=o>+</span> <span class=nv>'static</span><span class=o>&gt;&gt;</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>
</code></pre></div></div><p>This works because we are actually storing instances of <code class="highlighter-rouge language-plaintext">Box</code>, not primitive types; <code class="highlighter-rouge language-plaintext">dyn Display</code> means the type of the <em>trait object</em> <code class="highlighter-rouge language-plaintext">Display</code>. In this case, <code class="highlighter-rouge language-plaintext">Display</code> happens to be a common trait between <code class="highlighter-rouge language-plaintext">&amp;str</code> and <code class="highlighter-rouge language-plaintext">i32</code>.<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nn>std</span><span class=p>::</span><span class=nn>collections</span><span class=p>::</span><span class=n>HashMap</span><span class=p>;</span>
<span class=k>use</span> <span class=nn>std</span><span class=p>::</span><span class=nn>fmt</span><span class=p>::</span><span class=n>Display</span><span class=p>;</span>

<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>let</span> <span class=k>mut</span> <span class=n>map</span><span class=p>:</span> <span class=n>HashMap</span><span class=o>&lt;&amp;</span><span class=nb>str</span><span class=p>,</span> <span class=nb>Box</span><span class=o>&lt;</span><span class=n>dyn</span> <span class=n>Display</span> <span class=o>+</span> <span class=nv>'static</span><span class=o>&gt;&gt;</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>

    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"a"</span><span class=p>,</span> <span class=nn>Box</span><span class=p>::</span><span class=nf>new</span><span class=p>(</span><span class=s>"1"</span><span class=nf>.to_string</span><span class=p>()));</span>
    <span class=n>map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=nn>Box</span><span class=p>::</span><span class=nf>new</span><span class=p>(</span><span class=mi>2</span><span class=p>));</span>

    <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=n>in</span> <span class=o>&amp;</span><span class=n>map</span> <span class=p>{</span>
        <span class=nd>println!</span><span class=p>(</span><span class=s>"{}: {}"</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>You may wonder what would happen if we were to use the type <code class="highlighter-rouge language-plaintext">dyn Display</code> without the <code class="highlighter-rouge language-plaintext">Box</code> wrapper. If we try that, we’d get this nasty error:<div class="highlighter-rouge language-plaintext"><div class=highlight><pre class=highlight><code>error[E0277]: the size for values of type `(dyn std::fmt::Display + 'static)` cannot be known at compilation time
   --&gt; src/main.rs

     let mut map: HashMap&lt;&amp;str, (dyn Display + 'static)&gt; = HashMap::new();
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ doesn't have a size known at compile-time

    = help: the trait `std::marker::Sized` is not implemented for `(dyn std::fmt::Display + 'static)`
    = note: to learn more, visit &lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait&gt;
    = note: required by `std::collections::HashMap
</code></pre></div></div><p>This error may be confusing at first, but it actually makes sense. <a href=https://doc.rust-lang.org/book/ rel=external>The Rust Programming Language book</a> explains this very well in the <a href=https://doc.rust-lang.org/book/ch19-04-advanced-types.html rel=external>Advanced Types</a> chapter:<blockquote><p>“Rust needs to know how much memory to allocate for any value of a particular type, and all values of a type must use the same amount of memory.”</blockquote><p>The <code class="highlighter-rouge language-plaintext">Box&lt;T&gt;</code> type is a <a href=https://doc.rust-lang.org/reference/types/pointer.html rel=external><em>pointer type</em></a>. It lets us allocate data on the heap rather than the stack, and keeps a reference to the data in the stack in the form of a pointer, which is of fixed size.<h2 id=not-an-option-3-use-separate-maps-for-each-type>(Not an) Option #3: Use separate maps for each type</h2><p>Here we’re not actually using a <code class="highlighter-rouge language-plaintext">HashMap</code> with separate types, but rather two maps, each with its own type. It’s a bit more verbose and perhaps not the solution you’re looking for, but it’s worth keeping in mind that this works too:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=k>use</span> <span class=nn>std</span><span class=p>::</span><span class=nn>collections</span><span class=p>::</span><span class=n>HashMap</span><span class=p>;</span>

<span class=k>fn</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>let</span> <span class=k>mut</span> <span class=n>strings_map</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>
    <span class=k>let</span> <span class=k>mut</span> <span class=n>integers_map</span> <span class=o>=</span> <span class=nn>HashMap</span><span class=p>::</span><span class=nf>new</span><span class=p>();</span>

    <span class=n>strings_map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"a"</span><span class=p>,</span> <span class=s>"1"</span><span class=p>);</span>
    <span class=n>integers_map</span><span class=nf>.insert</span><span class=p>(</span><span class=s>"b"</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>

    <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=n>in</span> <span class=o>&amp;</span><span class=n>strings_map</span> <span class=p>{</span>
        <span class=nd>println!</span><span class=p>(</span><span class=s>"{}: {}"</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=k>for</span> <span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span> <span class=n>in</span> <span class=o>&amp;</span><span class=n>integers_map</span> <span class=p>{</span>
        <span class=nd>println!</span><span class=p>(</span><span class=s>"{}: {}"</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><p>It feels much simpler! And the output is naturally the same:<div class="highlighter-rouge language-rust"><div class=highlight><pre class=highlight><code><span class=n>a</span><span class=p>:</span> <span class=mi>1</span>
<span class=n>b</span><span class=p>:</span> <span class=mi>2</span>
</code></pre></div></div><h2 id=conclusion>Conclusion</h2><p>Rust is very strict when it comes to polymorphic types. As you’ve seen, there are ways to achieve it, but they don’t feel as straightforward as with other dynamic languages such as Ruby or Python. Sometimes though it’s useful to make one step back and look at the actual problem we’re trying to solve. Once I did that, I realized that I didn’t necessarily have to limit myself to a single data structure, so I went for the last option.<p>I’m still a beginner with Rust, so I might have missed on a better solution. <a href=https://doc.rust-lang.org/book/ch17-02-trait-objects.html rel=external>Trait Objects</a> could be one: I’ve experimented with them, but they weren’t quite was I was looking for. If you have any suggestions or know of other possible solutions, feel free to comment below!<hr><p><strong>Update</strong>: <a href=https://twitter.com/alilleybrinker/status/1280185393258926088 rel=external>@alilleybrinker</a> on Twitter pointed out two caveats to be aware of. One is about the meaning of the <code class="highlighter-rouge language-plaintext">'static</code> <em>bound</em>: when used on a generic type, any references inside the type must live as long as <code class="highlighter-rouge language-plaintext">'static</code>. However, by adding <code class="highlighter-rouge language-plaintext">'static</code> we are also effectively saying that the values inside the <code class="highlighter-rouge language-plaintext">Box</code> won’t contain references. The other caveat is that, when using <code class="highlighter-rouge language-plaintext">dyn Display</code>, the original types are erased, so the available methods are only those known from the <code class="highlighter-rouge language-plaintext">Display</code> trait.</div><footer><p class=meta><span class="author byline vcard">Posted by <span class=fn>Simone Vittori</span></span> Last update: <time>7th Jul 2020</time></footer></article></div></main><footer><div id="disqus_thread" aria-live="polite"></div><script>var disqus_config=function(){this.page.url="https://www.simonewebdesign.it/",this.page.identifier="https://www.simonewebdesign.it/rust-hashmap-insert-values-multiple-types/"},o=new IntersectionObserver(function(e){e[0].isIntersecting&&function(){o.disconnect();var e=document,t=e.createElement("script");t.src="https://simonewebdesign.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}()});o.observe(document.querySelector("#disqus_thread"))</script><noscript>Please enable JavaScript to view the comments.</noscript><div class=footer-social><a href=https://twitter.com/simonewebdesign rel=external><svg aria-label=Twitter role=img viewBox="0 0 512 512"xmlns=http://www.w3.org/2000/svg><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"fill=#444 /></svg> </a><a href=https://www.linkedin.com/in/simonewebdesign rel=external><svg aria-label=LinkedIn role=img viewBox="0 0 512 512"xmlns=http://www.w3.org/2000/svg fill=#444><circle cx=142 cy=138 r=37 /><path d="M244 194v198M142 194v198"stroke=#444 stroke-width=66 /><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg> </a><a href=https://github.com/simonewebdesign rel=external><svg aria-label=GitHub role=img viewBox="0 0 512 512"xmlns=http://www.w3.org/2000/svg><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"fill=#444 /></svg> </a><a href=https://stackoverflow.com/users/801544/simone rel=external><svg aria-label="Stack Overflow"role=img viewBox="0 0 512 512"xmlns=http://www.w3.org/2000/svg><path d="M293 89l90 120zm-53 50l115 97zm-41 65l136 64zm-23 69l148 31zm-6 68h150zm-45-44v105h241V297"fill=none stroke=#444 stroke-width=30 /></svg> </a><a href=/atom.xml><svg aria-label=RSS role=img viewBox="0 0 512 512"xmlns=http://www.w3.org/2000/svg><circle cx=145 cy=367 r=35 fill=#444 /><path d="M109 241c89 0 162 73 162 162M109 127c152 0 276 124 276 276"fill=none stroke=#444 stroke-width=60 /></svg></a></div><style media=print>footer a{display:none}</style></footer><script>navigator.serviceWorker.controller||navigator.serviceWorker.register("/sw.js")</script>